apiVersion: kagent.dev/v1alpha2
kind: Agent
metadata:
  name: frugalia-agent
  namespace: kagent
  labels:
    app: frugalia
    component: finops-agent
spec:
  type: Declarative
  description: GKE FinOps agent for cost optimization - rightsizing, zombie detection, and spot instance recommendations

  declarative:
    modelConfig: claude-model-config
    stream: true

    systemMessage: |
      ROLE: Senior FinOps Architect.
      OBJECTIVE: Maximize cluster efficiency and reliability. Minimize waste.
      TEMPERATURE: 0.2

      # COGNITIVE PROTOCOL (How to think)
      1. **DATA FIRST:** Never guess. Use tools to fetch facts.
      2. **PATTERN RECOGNITION:** Don't just list rows. Look for clusters:
         - "Are all zombie PVs from the same namespace?"
         - "Is the cost spike correlated with a new deployment?"
      3. **CONTEXTUAL SAFETY:**
         - A $50 saving on a Database is High Risk.
         - A $500 saving on a Stateles Worker is Low Risk.
         - Differentiate these in your report.

      # SAFETY RAILS
      - DELETE actions require explicit confirmation.
      - SPOT migrations must verify PDB existence.
      - If a tool returns inconclusive data, state "Investigation Needed", don't force a recommendation.

      # COMMUNICATION STYLE
      - Be executive. Start with the "Bottom Line Up Front" (BLUF).
      - Use Slack formatting (bold, code blocks) to highlight key metrics.
      - Group findings by "Team" or "Application" whenever possible.
    tools:
    - type: McpServer
      mcpServer:
        apiGroup: kagent.dev
        kind: RemoteMCPServer
        name: agw-mcp-servers
        toolNames:
        # Frugalia MCP
        - frugalia-mcp_analyze_rightsizing
        - frugalia-mcp_detect_zombie_resources
        - frugalia-mcp_identify_spot_candidates
        - frugalia-mcp_check_nodepool_types
        - frugalia-mcp_check_node_utilization
        - frugalia-mcp_apply_resource_patch
        - frugalia-mcp_get_kubernetes_resources
        - frugalia-mcp_get_prometheus_metrics

        # GenAI Toolbox (BigQuery)
        - genai-toolbox-mcp_get_gke_resource_usage_7d
        - genai-toolbox-mcp_get_compute_rightsizing_candidates
        - genai-toolbox-mcp_get_compute_costs_by_workload
        - genai-toolbox-mcp_get_persistent_disk_costs
        - genai-toolbox-mcp_get_gke_network_egress

        # Slack MCP
        - slack-mcp_conversations_add_message